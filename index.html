<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Pick'em Pool 2026-2027</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #D50A0A;
            --primary-dark: #9a0707;
            --secondary: #013369;
            --background: #0a0e14;
            --surface: #151a23;
            --surface-light: #1d2433;
            --text: #ffffff;
            --text-muted: #8b96a8;
            --success: #10b981;
            --warning: #f59e0b;
            --border: #2a3444;
        }

        body {
            font-family: 'Barlow', sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.01) 2px, rgba(255,255,255,0.01) 4px),
                radial-gradient(circle at 20% 50%, rgba(213, 10, 10, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(1, 51, 105, 0.05) 0%, transparent 50%);
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 2rem 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(213, 10, 10, 0.3);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.03) 10px,
                rgba(255,255,255,0.03) 20px
            );
            pointer-events: none;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3.5rem;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            position: relative;
        }

        .season {
            font-size: 1.1rem;
            font-weight: 500;
            letter-spacing: 2px;
            opacity: 0.95;
            position: relative;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 1px;
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-transform: uppercase;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-section {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .user-section label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        .user-section input {
            width: 100%;
            max-width: 400px;
            padding: 0.75rem 1rem;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .user-section input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(213, 10, 10, 0.1);
        }

        .week-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
            background: var(--surface);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .week-selector label {
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        .week-selector select {
            padding: 0.6rem 1rem;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .week-selector select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .week-selector button {
            padding: 0.6rem 1.5rem;
            background: var(--secondary);
            border: none;
            border-radius: 8px;
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        .week-selector button:hover {
            background: #014a8f;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(1, 51, 105, 0.3);
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .game-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .game-card:hover::before {
            opacity: 1;
        }

        .game-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(213, 10, 10, 0.15);
        }

        .game-time {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .team-option {
            background: var(--surface-light);
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-option:hover {
            background: rgba(213, 10, 10, 0.1);
            border-color: rgba(213, 10, 10, 0.3);
        }

        .team-option.selected {
            background: rgba(213, 10, 10, 0.2);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(213, 10, 10, 0.1);
        }

        .team-option.locked {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .team-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .spread {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .submit-picks {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 2rem auto;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: 10px;
            color: var(--text);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            box-shadow: 0 4px 16px rgba(213, 10, 10, 0.3);
        }

        .submit-picks:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(213, 10, 10, 0.4);
        }

        .submit-picks:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .standings-table {
            background: var(--surface);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .standings-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .standings-table th {
            background: var(--surface-light);
            padding: 1rem;
            text-align: left;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-muted);
            border-bottom: 2px solid var(--border);
        }

        .standings-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .standings-table tr:hover {
            background: var(--surface-light);
        }

        .standings-table tr:last-child td {
            border-bottom: none;
        }

        .rank {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .rank-1 { color: #ffd700; }
        .rank-2 { color: #c0c0c0; }
        .rank-3 { color: #cd7f32; }

        .points {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .message {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 600;
        }

        .message.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: var(--success);
        }

        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .message.info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }

        .picks-count {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-muted);
            text-align: center;
        }

        .admin-section {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .admin-section h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .admin-section p {
            margin-bottom: 1rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .admin-section code {
            background: var(--surface-light);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            color: var(--primary);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
                letter-spacing: 2px;
            }

            .season {
                font-size: 0.95rem;
            }

            .container {
                padding: 1rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                gap: 0.5rem;
            }

            .tabs::-webkit-scrollbar {
                display: none;
            }

            .tab {
                font-size: 1rem;
                padding: 0.6rem 1rem;
                white-space: nowrap;
                flex-shrink: 0;
            }

            .week-selector {
                flex-direction: column;
                align-items: stretch;
            }

            .week-selector select,
            .week-selector button {
                width: 100%;
            }

            .user-section input {
                max-width: 100%;
            }

            .submit-picks {
                max-width: 100%;
                font-size: 1.2rem;
            }

            .game-card {
                padding: 1rem;
            }

            .team-option {
                padding: 0.75rem;
            }

            .standings-table {
                overflow-x: auto;
            }

            .standings-table table {
                min-width: 600px;
            }

            /* Touch-friendly tap targets */
            .team-option,
            button,
            .tab {
                min-height: 44px;
                min-width: 44px;
            }
        }

        .copy-code {
            background: var(--surface-light);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-family: monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
            position: relative;
        }

        .copy-code button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--primary);
            border: none;
            border-radius: 4px;
            color: var(--text);
            cursor: pointer;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>NFL Pick'em Pool</h1>
        <div class="season">2026-2027 Season</div>
        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); margin-top: 0.25rem;">Build: ea85239</div>
    </div>

    <div class="container">
        <div class="user-section" id="login-section">
            <label for="username">Your Name:</label>
            <input type="text" id="username" placeholder="Enter your name to participate" autocomplete="username">
            <button id="login-btn" style="margin-top: 1rem; padding: 0.75rem 2rem; background: var(--primary); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Login</button>
        </div>

        <div class="user-section" id="logged-in-section" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <label style="display: inline; margin-right: 0.5rem;">Logged in as:</label>
                    <strong id="logged-in-username" style="color: var(--primary); font-size: 1.2rem;"></strong>
                </div>
                <button id="logout-btn" style="padding: 0.5rem 1.5rem; background: var(--surface-light); border: 2px solid var(--border); border-radius: 8px; color: var(--text); font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-size: 0.85rem;">Logout</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="make-picks">Make Picks</button>
            <button class="tab" data-tab="my-picks">My Picks</button>
            <button class="tab" data-tab="all-picks">All Picks</button>
            <button class="tab" data-tab="standings">Standings</button>
            <button class="tab" data-tab="admin">Admin</button>
        </div>

        <div id="make-picks" class="tab-content active">
            <div class="week-selector">
                <label for="week-select">Week:</label>
                <select id="week-select">
                    <option value="1">Week 1</option>
                </select>
                <button onclick="loadGames()">Load Games</button>
                <button onclick="loadData()" style="background: var(--success);">Refresh Data</button>
            </div>

            <div id="message-container"></div>

            <div class="picks-count">
                <strong>Selected: <span id="picks-count">0</span> / 3 games</strong>
            </div>

            <div class="games-grid" id="games-grid">
                <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    Click "Load Games" to see available games for the week
                </div>
            </div>

            <button class="submit-picks" id="submit-picks" disabled>Submit Picks</button>
        </div>

        <div id="my-picks" class="tab-content">
            <div id="my-picks-content">
                <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    Please login to view your pick history
                </div>
            </div>
        </div>

        <div id="all-picks" class="tab-content">
            <div class="week-selector">
                <label for="all-picks-week-select">Week:</label>
                <select id="all-picks-week-select">
                    <option value="1">Week 1</option>
                </select>
                <button onclick="loadAllPicks()">Load All Picks</button>
            </div>
            <div id="all-picks-content">
                <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    Select a week and click "Load All Picks" to see everyone's picks (only visible after games start)
                </div>
            </div>
        </div>

        <div id="standings" class="tab-content">
            <div class="standings-table">
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Total Points</th>
                            <th>Wins</th>
                            <th>Losses</th>
                            <th>Parlays Hit</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                <div class="spinner"></div>
                                Loading standings...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="admin" class="tab-content">
            <div class="admin-section" style="background: #1a1a2e; border: 2px solid #ef4444;">
                <h3 style="color: #ef4444;">üîß Debug: Test Pick Submission</h3>
                <p>Use this to test if picks can be written to the sheet (bypasses all validation):</p>
                <button onclick="sendDebugPick()" style="padding: 0.75rem 1.5rem; background: #ef4444; border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; margin-top: 1rem;">Send Debug Pick to Sheet</button>
                <p style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-muted);">This will add a row with "DEBUG_[timestamp]" to your Picks sheet. If this works but regular picks don't, the issue is in the picks validation code.</p>
            </div>

            <div class="admin-section">
                <h3>üß™ Test Mode (Off-Season Testing)</h3>
                <p>Use this to create fake game data for testing when the season is over:</p>

                <div style="margin: 1.5rem 0;">
                    <label for="test-week" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Test Week Number:</label>
                    <input type="number" id="test-week" value="1" min="1" max="18" style="padding: 0.5rem; border: 2px solid var(--border); border-radius: 4px; background: var(--surface-light); color: var(--text); margin-bottom: 1rem;">

                    <label for="test-num-games" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Number of Test Games:</label>
                    <input type="number" id="test-num-games" value="5" min="1" max="16" style="padding: 0.5rem; border: 2px solid var(--border); border-radius: 4px; background: var(--surface-light); color: var(--text); margin-bottom: 1rem;">

                    <button onclick="generateTestData()" style="padding: 0.75rem 1.5rem; background: var(--warning); border: none; border-radius: 8px; color: var(--background); font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Generate & Preview</button>
                    <button onclick="sendTestDataToSheet()" style="padding: 0.75rem 1.5rem; background: var(--success); border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; margin-left: 0.5rem;">Send to Google Sheet</button>
                    <button onclick="clearTestData()" style="padding: 0.75rem 1.5rem; background: #ef4444; border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; margin-left: 0.5rem;">Clear</button>
                </div>

                <div id="test-output" style="background: var(--surface-light); padding: 1rem; border-radius: 8px; margin-top: 1rem; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; max-height: 300px; overflow-y: auto;"></div>

                <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-muted);">
                    <strong>How to use:</strong>
                </p>
                <ol style="margin-left: 2rem; margin-top: 0.5rem; color: var(--text-muted); line-height: 1.6;">
                    <li>Click <strong>"Generate & Preview"</strong> to create test games and see them below</li>
                    <li>Click <strong>"Send to Google Sheet"</strong> to automatically add them to your Games sheet</li>
                    <li>Or manually copy the data and paste into your Google Sheet</li>
                </ol>
                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-muted);">
                    Test games start 1 hour from now, spaced 30 minutes apart. Perfect for testing deadline enforcement!
                </p>
            </div>

            <div class="admin-section">
                <h3>üìã Setup Instructions</h3>
                
                <p><strong>Step 1: Set up Google Apps Script (one-time)</strong></p>
                <ol style="margin-left: 2rem; margin-bottom: 1.5rem; color: var(--text-muted); line-height: 1.8;">
                    <li>Open your Google Sheet</li>
                    <li>Click <strong>Extensions ‚Üí Apps Script</strong></li>
                    <li>Delete any existing code</li>
                    <li>Copy the code from <code>google-apps-script.js</code> file</li>
                    <li>Paste it into Apps Script and click <strong>Save</strong></li>
                    <li>Click <strong>Deploy ‚Üí New deployment</strong></li>
                    <li>Select type: <strong>Web app</strong></li>
                    <li>Execute as: <strong>Me</strong></li>
                    <li>Who has access: <strong>Anyone</strong></li>
                    <li>Click <strong>Deploy</strong> and authorize the script</li>
                    <li>Copy the <strong>Web App URL</strong></li>
                </ol>
                
                <p><strong>Step 2: Configure this website</strong></p>
                <ol style="margin-left: 2rem; margin-bottom: 1.5rem; color: var(--text-muted); line-height: 1.8;">
                    <li>Get your Google Sheet ID from the URL (the long string between /d/ and /edit)</li>
                    <li>Open <code>index.html</code> in a text editor</li>
                    <li>Find the CONFIGURATION section at the top of the script</li>
                    <li>Replace <code>YOUR_SHEET_ID_HERE</code> with your Sheet ID</li>
                    <li>Replace <code>YOUR_APPS_SCRIPT_URL_HERE</code> with your Web App URL</li>
                    <li>Save and re-upload to GitHub</li>
                </ol>
                
                <p><strong>Step 3: Share your Google Sheet</strong></p>
                <ol style="margin-left: 2rem; margin-bottom: 1.5rem; color: var(--text-muted); line-height: 1.8;">
                    <li>Click the <strong>Share</strong> button in your Google Sheet</li>
                    <li>Change to "Anyone with the link" can <strong>VIEW</strong></li>
                    <li>The Apps Script handles all writing</li>
                </ol>
            </div>

            <div class="admin-section">
                <h3>üèà How to Use (Weekly Workflow)</h3>
                
                <p><strong>Before the week starts:</strong></p>
                <ol style="margin-left: 2rem; margin-bottom: 1.5rem; color: var(--text-muted); line-height: 1.8;">
                    <li>Open your Google Sheet</li>
                    <li>Click the <strong>üèà NFL Pick'em</strong> menu at the top</li>
                    <li>Click <strong>Scrape Lines from ESPN</strong></li>
                    <li>Enter the week number (1-18)</li>
                    <li>‚úÖ Games automatically populate with spreads!</li>
                </ol>
                
                <p><strong>Users make picks:</strong></p>
                <ol style="margin-left: 2rem; margin-bottom: 1.5rem; color: var(--text-muted); line-height: 1.8;">
                    <li>Users visit this website</li>
                    <li>Enter their name</li>
                    <li>Select 3 games against the spread</li>
                    <li>Click "Submit Picks"</li>
                    <li>‚úÖ Picks automatically saved to Google Sheet!</li>
                </ol>
                
                <p><strong>After games finish:</strong></p>
                <ol style="margin-left: 2rem; margin-bottom: 1.5rem; color: var(--text-muted); line-height: 1.8;">
                    <li>In Google Sheet, update the <strong>Winner</strong> column in "Games" tab</li>
                    <li>Enter "away" or "home" for each completed game</li>
                    <li>Click <strong>üèà NFL Pick'em ‚Üí Calculate Scores</strong></li>
                    <li>‚úÖ Standings update automatically!</li>
                </ol>
                
                <p style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3); margin-top: 1.5rem;">
                    <strong>‚úÖ Fully Automated!</strong> Everything happens in Google Sheets or automatically from the website. No manual data entry needed!
                </p>
            </div>

            <div class="admin-section">
                <h3>üéØ Scoring System</h3>
                <ul style="margin-left: 2rem; color: var(--text-muted); line-height: 1.8;">
                    <li><strong>1 point</strong> for each correct pick</li>
                    <li><strong>+1 bonus point</strong> if all 3 picks are correct</li>
                    <li><strong>Total possible:</strong> 4 points per week (3 wins + 1 parlay bonus)</li>
                </ul>
            </div>

            <div class="admin-section">
                <h3>üìä Current Configuration</h3>
                <p style="margin-bottom: 0.5rem;"><strong>Sheet ID:</strong></p>
                <code style="display: block; background: var(--surface-light); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; word-break: break-all;">${SHEET_ID}</code>
                
                <p style="margin-bottom: 0.5rem;"><strong>Apps Script URL:</strong></p>
                <code style="display: block; background: var(--surface-light); padding: 0.75rem; border-radius: 8px; word-break: break-all;">${SCRIPT_URL}</code>
                
                <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-muted);">
                    To change these, edit the HTML file and re-upload to GitHub.
                </p>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURATION - EDIT THESE VALUES
        // ========================================
        
        // Paste your Google Sheet ID here (the long string in your sheet URL)
        const SHEET_ID = '1S-yXXxxjL_FgVHZED_8zFRrdQxJGVRluamhd-Jk9ilc';
        
        // Paste your Google Apps Script Web App URL here (from Deploy step)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxcg6U5paqIYaIWsDGSlN7IiOVL8qRLJT9AXWHGOifc-heboZL2cGpARPykMwXiQ2aO/exec';
        
        // ========================================
        
        const SHEET_ID_KEY = 'nfl-pickem-sheet-id';
        const SCRIPT_URL_KEY = 'nfl-pickem-script-url';
        
        // Data structures
        let gameData = {};
        let picksData = [];
        let standingsData = [];
        let selectedGames = new Set();
        let currentWeek = 1;
        let currentUser = null;
        const CURRENT_USER_KEY = 'nfl-pickem-current-user';

        // Initialize
        window.addEventListener('load', () => {
            // Check if configuration is set
            if (SHEET_ID === 'YOUR_SHEET_ID_HERE' || SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL_HERE') {
                showMessage('error', 'Please edit the HTML file and add your Sheet ID and Apps Script URL at the top of the script section.');
                return;
            }

            // Check for saved user
            const savedUser = localStorage.getItem(CURRENT_USER_KEY);
            if (savedUser) {
                currentUser = savedUser;
                showLoggedInState();
            }

            // Auto-load data on page load
            loadData();
        });

        // Login functionality
        document.getElementById('login-btn').addEventListener('click', () => {
            const username = document.getElementById('username').value.trim();
            if (!username) {
                showMessage('error', 'Please enter your name to login');
                return;
            }
            currentUser = username;
            localStorage.setItem(CURRENT_USER_KEY, username);
            showLoggedInState();
            showMessage('success', `Welcome, ${username}!`);
            loadMyPicks();
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem(CURRENT_USER_KEY);
                showLoginState();
                showMessage('info', 'You have been logged out');
            }
        });

        // Allow enter key to login
        document.getElementById('username').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('login-btn').click();
            }
        });

        function showLoggedInState() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('logged-in-section').style.display = 'block';
            document.getElementById('logged-in-username').textContent = currentUser;
        }

        function showLoginState() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('logged-in-section').style.display = 'none';
            document.getElementById('username').value = '';
        }

        // Load data from Google Sheets
        async function loadData() {
            if (!SHEET_ID) {
                showMessage('error', 'Please set up your Google Sheet ID in the Admin tab first!');
                return;
            }

            try {
                showMessage('info', 'Loading data from Google Sheets...');
                
                // Load Games
                const gamesUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Games`;
                const gamesResponse = await fetch(gamesUrl);
                const gamesText = await gamesResponse.text();
                const gamesJson = JSON.parse(gamesText.substring(47).slice(0, -2));
                
                // Helper function to parse Google Sheets date/time
                function parseGoogleSheetsDate(value) {
                    if (!value) return null;

                    // If it's already a formatted string (from f property), use it
                    if (typeof value === 'string' && !value.startsWith('Date(')) {
                        return value;
                    }

                    // If it's a Date object string like "Date(2026,11,25,13,0,0)"
                    if (typeof value === 'string' && value.startsWith('Date(')) {
                        const match = value.match(/Date\((\d+),(\d+),(\d+),(\d+),(\d+),(\d+)\)/);
                        if (match) {
                            const [, year, month, day, hour, minute, second] = match;
                            const date = new Date(parseInt(year), parseInt(month), parseInt(day), parseInt(hour), parseInt(minute), parseInt(second));
                            return date.toLocaleString('en-US', {
                                timeZone: 'America/New_York',
                                weekday: 'short',
                                month: 'short',
                                day: 'numeric',
                                hour: 'numeric',
                                minute: '2-digit',
                                hour12: true
                            });
                        }
                    }

                    return value;
                }

                // Parse games data
                gameData = {};
                gamesJson.table.rows.forEach(row => {
                    const week = row.c[0]?.v;
                    const gameId = row.c[1]?.v;
                    const away = row.c[2]?.v;
                    const home = row.c[3]?.v;
                    const spread = row.c[4]?.v;
                    const awaySpread = row.c[5]?.v;
                    const gameTimeRaw = row.c[6]?.v;
                    const gameTimeFormatted = row.c[6]?.f; // Formatted value from Google Sheets
                    const winner = row.c[7]?.v;

                    // Use formatted value if available, otherwise parse the raw value
                    const gameTime = gameTimeFormatted || parseGoogleSheetsDate(gameTimeRaw);

                    if (week && gameId) {
                        if (!gameData[week]) gameData[week] = [];
                        gameData[week].push({
                            id: gameId,
                            away,
                            home,
                            spread,
                            awaySpread,
                            time: gameTime,
                            winner
                        });
                    }
                });

                // Load Picks (with cache-busting to force fresh data)
                const cacheBuster = new Date().getTime();
                const picksUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Picks&_=${cacheBuster}`;
                const picksResponse = await fetch(picksUrl);
                const picksText = await picksResponse.text();
                const picksJson = JSON.parse(picksText.substring(47).slice(0, -2));

                picksData = [];
                console.log('Loading picks from Google Sheets. Total rows:', picksJson.table.rows.length);
                picksJson.table.rows.forEach(row => {
                    const username = row.c[0]?.v;
                    const week = row.c[1]?.v;
                    const picks = row.c[2]?.v;

                    if (username && week) {
                        picksData.push({ username, week, picks });
                        console.log('Loaded pick:', { username, week, picks });
                    }
                });
                console.log('Total picks loaded:', picksData.length);

                // Load Standings
                const standingsUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Standings`;
                const standingsResponse = await fetch(standingsUrl);
                const standingsText = await standingsResponse.text();
                const standingsJson = JSON.parse(standingsText.substring(47).slice(0, -2));
                
                standingsData = [];
                standingsJson.table.rows.forEach(row => {
                    const username = row.c[0]?.v;
                    const totalPoints = row.c[1]?.v || 0;
                    const wins = row.c[2]?.v || 0;
                    const losses = row.c[3]?.v || 0;
                    const parlays = row.c[4]?.v || 0;
                    
                    if (username) {
                        standingsData.push({ username, totalPoints, wins, losses, parlays });
                    }
                });

                populateWeekSelectors();
                updateStandings();
                showMessage('success', 'Data loaded successfully from Google Sheets!');
            } catch (error) {
                console.error('Error loading data:', error);
                showMessage('error', 'Error loading data. Check your Sheet ID and make sure the sheet is shared publicly (view only).');
            }
        }

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Populate week selectors
        function populateWeekSelectors() {
            const weeks = Object.keys(gameData).sort((a, b) => a - b);
            const weekSelect = document.getElementById('week-select');
            const allPicksWeekSelect = document.getElementById('all-picks-week-select');

            if (weeks.length > 0) {
                const options = weeks.map(w => `<option value="${w}">Week ${w}</option>`).join('');
                weekSelect.innerHTML = options;
                allPicksWeekSelect.innerHTML = options;
            }
        }

        // Helper function to check if game has started
        function hasGameStarted(gameTimeStr) {
            if (!gameTimeStr || gameTimeStr === 'TBD') return false;
            try {
                const gameTime = new Date(gameTimeStr);
                const now = new Date();
                return now >= gameTime;
            } catch (e) {
                return false;
            }
        }

        // Load games for selected week
        function loadGames() {
            const week = document.getElementById('week-select').value;
            if (!currentUser) {
                showMessage('error', 'Please login first to make picks!');
                return;
            }

            currentWeek = week;
            selectedGames.clear();

            const games = gameData[week];
            const gamesGrid = document.getElementById('games-grid');

            if (!games || games.length === 0) {
                gamesGrid.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-muted);">No games available for this week. Use the Admin tab to scrape lines from ESPN.</div>';
                return;
            }

            // Get user's existing picks for this week
            const userPicksForWeek = picksData.filter(p => p.username === currentUser && p.week == week);
            const allUserPicks = userPicksForWeek.flatMap(p => p.picks.split(',')).map(pick => pick.trim());

            gamesGrid.innerHTML = games.map(game => {
                const awaySpreadDisplay = game.awaySpread > 0 ? `+${game.awaySpread}` : game.awaySpread;
                const homeSpreadDisplay = game.awaySpread < 0 ? `+${Math.abs(game.awaySpread)}` : -game.awaySpread;

                const gameStarted = hasGameStarted(game.time);
                const awayPicked = allUserPicks.includes(`${game.id}-away`);
                const homePicked = allUserPicks.includes(`${game.id}-home`);
                const gameLocked = gameStarted || awayPicked || homePicked;

                let statusBadge = '';
                if (gameStarted) {
                    statusBadge = '<div style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; display: inline-block; margin-bottom: 0.5rem;">Game Started</div>';
                } else if (awayPicked || homePicked) {
                    statusBadge = '<div style="background: rgba(16, 185, 129, 0.2); color: var(--success); padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; display: inline-block; margin-bottom: 0.5rem;">Pick Submitted</div>';
                }

                return `
                <div class="game-card">
                    ${statusBadge}
                    <div class="game-time">${game.time || 'TBD'}</div>
                    <div class="team-option ${gameLocked ? 'locked' : ''} ${awayPicked ? 'selected' : ''}" data-game-id="${game.id}" data-team="away" data-game-time="${game.time || ''}">
                        <span class="team-name">${game.away}</span>
                        <span class="spread">${awaySpreadDisplay}</span>
                    </div>
                    <div class="team-option ${gameLocked ? 'locked' : ''} ${homePicked ? 'selected' : ''}" data-game-id="${game.id}" data-team="home" data-game-time="${game.time || ''}">
                        <span class="team-name">${game.home}</span>
                        <span class="spread">${homeSpreadDisplay}</span>
                    </div>
                </div>
            `}).join('');

            // Add click handlers only for unlocked games
            document.querySelectorAll('.team-option:not(.locked)').forEach(option => {
                option.addEventListener('click', () => selectTeam(option));
            });

            updatePicksCount();
        }

        // Select a team
        function selectTeam(option) {
            const gameId = option.dataset.gameId;
            const team = option.dataset.team;

            // Deselect other team in same game
            document.querySelectorAll(`[data-game-id="${gameId}"]`).forEach(opt => {
                opt.classList.remove('selected');
            });

            // Check if game was already selected
            const wasSelected = selectedGames.has(gameId);
            
            // Remove previous selection for this game
            for (let selected of selectedGames) {
                if (selected.startsWith(gameId)) {
                    selectedGames.delete(selected);
                }
            }

            // Toggle selection
            if (!wasSelected || !option.classList.contains('selected')) {
                option.classList.add('selected');
                selectedGames.add(`${gameId}-${team}`);
            }

            updatePicksCount();
        }

        // Update picks count
        function updatePicksCount() {
            const count = selectedGames.size;
            document.getElementById('picks-count').textContent = count;

            // Get total picks already made this week
            const userPicksForWeek = picksData.filter(p => p.username === currentUser && p.week == currentWeek);
            const totalPicksMade = userPicksForWeek.flatMap(p => p.picks.split(',')).length;

            // Can submit 1-3 picks, but total for week can't exceed 3
            const canSubmit = count > 0 && count <= 3 && (totalPicksMade + count) <= 3;
            document.getElementById('submit-picks').disabled = !canSubmit;

            // Update button text to show remaining picks
            const remaining = 3 - totalPicksMade;
            const submitBtn = document.getElementById('submit-picks');
            if (remaining === 0) {
                submitBtn.textContent = `All Picks Submitted for Week ${currentWeek}`;
            } else if (count > 0) {
                submitBtn.textContent = `Submit ${count} Pick${count > 1 ? 's' : ''} (${remaining - count} remaining)`;
            } else {
                submitBtn.textContent = `Select Picks (${remaining} remaining)`;
            }
        }

        // Submit picks
        document.getElementById('submit-picks').addEventListener('click', async () => {
            if (!currentUser) {
                showMessage('error', 'Please login first!');
                return;
            }

            if (selectedGames.size === 0) {
                showMessage('error', 'Please select at least one game!');
                return;
            }

            // Check total picks for the week won't exceed 3
            const userPicksForWeek = picksData.filter(p => p.username === currentUser && p.week == currentWeek);
            const totalPicksMade = userPicksForWeek.flatMap(p => p.picks.split(',')).length;

            if (totalPicksMade + selectedGames.size > 3) {
                showMessage('error', `You can only make 3 picks per week. You already have ${totalPicksMade} pick(s).`);
                return;
            }

            if (!SHEET_ID || !SCRIPT_URL) {
                showMessage('error', 'Google Sheet not configured. See Admin tab.');
                return;
            }

            // Check if any selected games have started
            let hasStartedGames = false;
            for (const pick of selectedGames) {
                const [gameId] = pick.split('-');
                const game = gameData[currentWeek].find(g => g.id === gameId);
                if (game && hasGameStarted(game.time)) {
                    hasStartedGames = true;
                    break;
                }
            }

            if (hasStartedGames) {
                showMessage('error', 'One or more of your selected games has already started!');
                return;
            }

            const picksString = Array.from(selectedGames).join(',');
            const weekNumber = parseInt(currentWeek, 10); // Ensure week is a number

            showMessage('info', 'Submitting picks to Google Sheets...');
            console.log('Submitting picks:', { username: currentUser, week: weekNumber, picks: picksString });

            try {
                // Submit to Google Apps Script using form data approach
                // This method works better with Google Apps Script's redirect handling
                const formData = new FormData();
                formData.append('payload', JSON.stringify({
                    username: currentUser,
                    week: weekNumber,
                    picks: picksString
                }));

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });

                // Note: With no-cors mode, we can't read the response
                // But if no error is thrown, the request was sent successfully
                showMessage('success', `‚úì ${selectedGames.size} pick(s) submitted successfully for Week ${currentWeek}! Your picks have been saved to the Google Sheet.`);
                console.log('Picks submitted successfully');

                selectedGames.clear();
                updatePicksCount();

                // Reload data after a delay to allow Google Sheets to update
                // Google Sheets public API can have a caching delay
                setTimeout(() => {
                    showMessage('info', 'Refreshing data to verify picks were saved...');
                    loadData().then(() => {
                        loadGames(); // Reload games to show updated status
                        loadMyPicks(); // Refresh user's pick history
                        showMessage('success', 'Data refreshed! Check "My Picks" tab to see your saved picks.');
                    });
                }, 5000); // Increased delay to 5 seconds to account for Google Sheets caching

            } catch (error) {
                console.error('Error submitting picks:', error);
                showMessage('error', '‚úó Error submitting picks. Please check your Apps Script URL configuration in the Admin tab and try again.');
            }
        });

        // Update standings
        function updateStandings() {
            const tbody = document.getElementById('standings-body');
            
            if (standingsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted);">No standings data yet. Make your picks to get started!</td></tr>';
                return;
            }

            const sortedStandings = [...standingsData].sort((a, b) => b.totalPoints - a.totalPoints);

            tbody.innerHTML = sortedStandings.map((data, index) => `
                <tr>
                    <td><span class="rank rank-${index + 1}">${index + 1}</span></td>
                    <td><strong>${data.username}</strong></td>
                    <td><span class="points">${data.totalPoints}</span></td>
                    <td>${data.wins}</td>
                    <td>${data.losses}</td>
                    <td>${data.parlays}</td>
                </tr>
            `).join('');
        }

        // Load user's pick history
        function loadMyPicks() {
            const container = document.getElementById('my-picks-content');

            if (!currentUser) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-muted);">Please login to view your pick history</div>';
                return;
            }

            console.log('loadMyPicks() called for user:', currentUser);
            console.log('Total picks in picksData:', picksData.length);
            console.log('All picksData:', picksData);

            const myPicks = picksData.filter(p => p.username === currentUser);

            console.log('Filtered picks for', currentUser + ':', myPicks);

            if (myPicks.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-muted);">You haven\'t made any picks yet. Go to "Make Picks" to get started!</div>';
                return;
            }

            // Group picks by week
            const picksByWeek = {};
            myPicks.forEach(pick => {
                if (!picksByWeek[pick.week]) {
                    picksByWeek[pick.week] = [];
                }
                picksByWeek[pick.week].push(pick);
            });

            let html = '<div style="display: flex; flex-direction: column; gap: 2rem;">';

            Object.keys(picksByWeek).sort((a, b) => b - a).forEach(week => {
                const weekPicks = picksByWeek[week];
                const allPicksForWeek = weekPicks.flatMap(p => p.picks.split(',')).map(pick => pick.trim());

                html += `
                    <div class="admin-section">
                        <h3 style="color: var(--primary); font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; margin-bottom: 1rem;">Week ${week}</h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                `;

                allPicksForWeek.forEach(pick => {
                    const [gameId, team] = pick.split('-');
                    const game = gameData[week]?.find(g => g.id === gameId);

                    if (game) {
                        const teamName = team === 'away' ? game.away : game.home;
                        const spread = team === 'away' ? game.awaySpread : -game.awaySpread;
                        const spreadDisplay = spread > 0 ? `+${spread}` : spread;

                        let resultBadge = '';
                        if (game.winner) {
                            const won = game.winner === team;
                            resultBadge = won
                                ? '<span style="background: rgba(16, 185, 129, 0.2); color: var(--success); padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; margin-left: 1rem;">WIN</span>'
                                : '<span style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; margin-left: 1rem;">LOSS</span>';
                        } else {
                            resultBadge = '<span style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; margin-left: 1rem;">PENDING</span>';
                        }

                        html += `
                            <div style="background: var(--surface-light); padding: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                                <div>
                                    <strong style="font-size: 1.1rem;">${teamName}</strong>
                                    <span style="color: var(--primary); font-weight: 700; margin-left: 0.5rem;">${spreadDisplay}</span>
                                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">${game.away} @ ${game.home}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">${game.time || 'TBD'}</div>
                                </div>
                                <div>
                                    ${resultBadge}
                                </div>
                            </div>
                        `;
                    }
                });

                html += `</div></div>`;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Load all users' picks for a week
        function loadAllPicks() {
            const week = document.getElementById('all-picks-week-select').value;
            const container = document.getElementById('all-picks-content');

            const games = gameData[week];
            if (!games || games.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-muted);">No games available for this week.</div>';
                return;
            }

            const weekPicks = picksData.filter(p => p.week == week);

            if (weekPicks.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-muted);">No picks have been made for this week yet.</div>';
                return;
            }

            // Group picks by game
            const picksByGame = {};
            weekPicks.forEach(userPick => {
                const picks = userPick.picks.split(',').map(p => p.trim());
                picks.forEach(pick => {
                    const [gameId, team] = pick.split('-');
                    if (!picksByGame[gameId]) {
                        picksByGame[gameId] = { away: [], home: [] };
                    }
                    picksByGame[gameId][team].push(userPick.username);
                });
            });

            let html = '<div style="display: flex; flex-direction: column; gap: 1.5rem;">';

            games.forEach(game => {
                const gameStarted = hasGameStarted(game.time);
                const gamePicks = picksByGame[game.id] || { away: [], home: [] };

                // Only show picks if game has started
                if (!gameStarted && (gamePicks.away.length > 0 || gamePicks.home.length > 0)) {
                    // Show that picks exist but don't reveal them
                    html += `
                        <div class="game-card">
                            <div class="game-time">${game.time || 'TBD'}</div>
                            <div style="text-align: center; padding: 1rem; color: var(--text-muted); font-style: italic;">
                                ${gamePicks.away.length + gamePicks.home.length} pick(s) made - visible after game starts
                            </div>
                            <div style="margin-top: 0.5rem; padding: 0.75rem; background: var(--surface-light); border-radius: 8px;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">${game.away} @ ${game.home}</div>
                                <div style="font-size: 0.9rem; color: var(--text-muted);">Spread: ${game.spread}</div>
                            </div>
                        </div>
                    `;
                } else if (gameStarted && (gamePicks.away.length > 0 || gamePicks.home.length > 0)) {
                    // Show actual picks
                    const awaySpreadDisplay = game.awaySpread > 0 ? `+${game.awaySpread}` : game.awaySpread;
                    const homeSpreadDisplay = game.awaySpread < 0 ? `+${Math.abs(game.awaySpread)}` : -game.awaySpread;

                    html += `
                        <div class="game-card">
                            <div style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; display: inline-block; margin-bottom: 0.5rem;">Game Started</div>
                            <div class="game-time">${game.time || 'TBD'}</div>
                            <div style="background: var(--surface-light); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="font-weight: 600;">${game.away}</span>
                                    <span style="color: var(--primary); font-weight: 700;">${awaySpreadDisplay}</span>
                                </div>
                                ${gamePicks.away.length > 0 ? `<div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">Picked by: ${gamePicks.away.join(', ')}</div>` : '<div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">No picks</div>'}
                            </div>
                            <div style="background: var(--surface-light); padding: 1rem; border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="font-weight: 600;">${game.home}</span>
                                    <span style="color: var(--primary); font-weight: 700;">${homeSpreadDisplay}</span>
                                </div>
                                ${gamePicks.home.length > 0 ? `<div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">Picked by: ${gamePicks.home.join(', ')}</div>` : '<div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">No picks</div>'}
                            </div>
                        </div>
                    `;
                }
            });

            html += '</div>';
            container.innerHTML = html || '<div style="text-align: center; padding: 2rem; color: var(--text-muted);">No visible picks for this week yet.</div>';
        }

        // Show message
        function showMessage(type, text) {
            const container = document.getElementById('message-container');
            container.innerHTML = `<div class="message ${type}">${text}</div>`;

            if (type !== 'info') {
                setTimeout(() => {
                    container.innerHTML = '';
                }, 10000);
            }
        }

        // Store generated test games for sending to sheet
        let generatedTestGames = [];

        // Generate test data for off-season testing
        function generateTestData() {
            const week = parseInt(document.getElementById('test-week').value);
            const numGames = parseInt(document.getElementById('test-num-games').value);

            const teams = [
                'Kansas City Chiefs', 'Buffalo Bills', 'Baltimore Ravens', 'San Francisco 49ers',
                'Dallas Cowboys', 'Philadelphia Eagles', 'Miami Dolphins', 'Detroit Lions',
                'Los Angeles Rams', 'Cleveland Browns', 'Jacksonville Jaguars', 'Cincinnati Bengals',
                'New Orleans Saints', 'Green Bay Packers', 'Minnesota Vikings', 'Tampa Bay Buccaneers',
                'Seattle Seahawks', 'Los Angeles Chargers', 'Pittsburgh Steelers', 'Houston Texans',
                'Atlanta Falcons', 'New York Jets', 'Las Vegas Raiders', 'Tennessee Titans',
                'Indianapolis Colts', 'Washington Commanders', 'Denver Broncos', 'New England Patriots',
                'Carolina Panthers', 'Chicago Bears', 'Arizona Cardinals', 'New York Giants'
            ];

            let output = 'Week\tGameID\tAway\tHome\tSpread\tAwaySpread\tGameTime\tWinner\n';
            generatedTestGames = []; // Clear previous games
            const now = new Date();

            for (let i = 0; i < numGames; i++) {
                // Pick two random different teams
                const awayIndex = Math.floor(Math.random() * teams.length);
                let homeIndex = Math.floor(Math.random() * teams.length);
                while (homeIndex === awayIndex) {
                    homeIndex = Math.floor(Math.random() * teams.length);
                }

                const awayTeam = teams[awayIndex];
                const homeTeam = teams[homeIndex];

                // Generate random spread between -14 and +14
                const awaySpread = (Math.random() * 28 - 14).toFixed(1);
                const spreadValue = parseFloat(awaySpread);
                const favoredTeam = spreadValue < 0 ? awayTeam.split(' ').pop() : homeTeam.split(' ').pop();
                const spread = `${favoredTeam} ${Math.abs(spreadValue).toFixed(1)}`;

                // Game time: starts 1 hour from now, each game 30 minutes apart
                const gameTime = new Date(now.getTime() + (60 + i * 30) * 60000);
                const gameTimeStr = gameTime.toLocaleString('en-US', {
                    timeZone: 'America/New_York',
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });

                const gameId = `${week}-${i + 1}`;

                // Store for sending to sheet
                generatedTestGames.push({
                    week,
                    gameId,
                    away: awayTeam,
                    home: homeTeam,
                    spread,
                    awaySpread: parseFloat(awaySpread),
                    gameTime: gameTime.toISOString(), // Store as ISO string for proper parsing
                    winner: ''
                });

                output += `${week}\t${gameId}\t${awayTeam}\t${homeTeam}\t${spread}\t${awaySpread}\t${gameTimeStr}\t\n`;
            }

            document.getElementById('test-output').textContent = output;
            showMessage('success', `Generated ${numGames} test games for Week ${week}! Click "Send to Google Sheet" to add them automatically.`);
        }

        // Send test data to Google Sheet
        async function sendTestDataToSheet() {
            if (generatedTestGames.length === 0) {
                showMessage('error', 'Please generate test games first!');
                return;
            }

            if (!SCRIPT_URL) {
                showMessage('error', 'Apps Script URL not configured. See Admin tab for setup instructions.');
                return;
            }

            const gameCount = generatedTestGames.length;
            showMessage('info', `Sending ${gameCount} test games to Google Sheet...`);

            try {
                // Submit using FormData approach for better compatibility
                const formData = new FormData();
                formData.append('payload', JSON.stringify({
                    action: 'addTestGames',
                    games: generatedTestGames
                }));

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });

                // Note: With no-cors mode, we can't read the response, but if no error thrown, request was sent
                showMessage('success', `‚úì Successfully sent ${gameCount} test games to Google Sheet! The games have been added to your Games sheet. Refresh the page to load them.`);

                // Reload data after a short delay to show the new games
                setTimeout(() => {
                    loadData().then(() => {
                        showMessage('success', `Test games loaded! Check the "Make Picks" tab.`);
                    });
                }, 2000);

            } catch (error) {
                console.error('Error sending test data:', error);
                showMessage('error', '‚úó Error sending test data to Google Sheet. Please check your Apps Script URL configuration or try copying and pasting manually instead.');
            }
        }

        // Clear test data display
        function clearTestData() {
            document.getElementById('test-output').textContent = '';
            showMessage('info', 'Test data display cleared.');
        }

        // DEBUG: Send a debug pick to test if the picks path works
        async function sendDebugPick() {
            if (!SCRIPT_URL) {
                showMessage('error', 'Apps Script URL not configured.');
                return;
            }

            showMessage('info', 'Sending debug pick to Google Sheet...');
            console.log('Sending debug pick request...');

            try {
                const formData = new FormData();
                formData.append('payload', JSON.stringify({
                    action: 'debugPick',
                    username: 'DebugUser',
                    week: 99,
                    picks: 'debug-test-pick'
                }));

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });

                showMessage('success', '‚úì Debug pick sent! Check your Picks sheet for a row with "DebugUser" in week 99. If it appears, the web request is working correctly.');
                console.log('Debug pick request sent successfully');

                // Reload after delay
                setTimeout(() => {
                    loadData().then(() => {
                        showMessage('info', 'Data refreshed. Check Picks sheet in Google Sheets directly.');
                    });
                }, 3000);

            } catch (error) {
                console.error('Error sending debug pick:', error);
                showMessage('error', '‚úó Error sending debug pick: ' + error.message);
            }
        }
    </script>
</body>
</html>
